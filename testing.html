<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Testing Chestnut | Chestnut</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.3.4">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./FAQ.html" />
    
    
    <link rel="prev" href="./03_00_developer_notes.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">

    
    <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
    


        
    <div class="book" data-level="4" data-basepath="." data-revision="1436784878423">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="01_00_getting_started.html">
            
                
                    <a href="./01_00_getting_started.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Getting Started
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="01_01_list_of_contents.html">
            
                
                    <a href="./01_01_list_of_contents.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         List of Contents
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="01_02_invoking_chestnut.html">
            
                
                    <a href="./01_02_invoking_chestnut.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Invoking Chestnut
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="02_00_recipes.html">
            
                
                    <a href="./02_00_recipes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Recipes
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="02_01_alternatives_to_om_dom.html">
            
                
                    <a href="./02_01_alternatives_to_om_dom.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Alternatives to om.dom
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="02_02_testing.html">
            
                
                    <a href="./02_02_testing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Testing Your App
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="03_00_developer_notes.html">
            
                
                    <a href="./03_00_developer_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Developer Notes
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="4" data-path="testing.html">
            
                
                    <a href="./testing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Testing Chestnut
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="FAQ.html">
            
                
                    <a href="./FAQ.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         FAQ
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="CHANGELOG.html">
            
                
                    <a href="./CHANGELOG.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         Changelog
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <a href="./GLOSSARY.html" class="btn pull-left" aria-label="Open Glossary"><i class="fa fa-sort-alpha-asc"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Chestnut</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_11">
                    
                        <h1 id="testing-chestnut"><a name="testing-chestnut" class="plugin-anchor" href="#testing-chestnut"><span class="fa fa-link"></span></a>Testing Chestnut</h1>
<p>(This page is about testing Chestnut itself, <em>not</em> about how to do testing in your Chestnut app. For that see <a href="02_02_testing.html">Testing Your App</a>)</p>
<p>Because of the nature of Chestnut, testing it requires an interplay between terminal, repl, and browser. This is hard to automate, but we&apos;re trying anyway :) There are some basic tests available, but the test suite is not comprehensive.</p>
<p>For process control the tests depend on unreleased features of <a href="https://github.com/jnr/jnr-process" target="_blank">jnr-process</a>, which in turn relies on unreleased code in <a href="https://github.com/jnr/jnr-posix" target="_blank">jnr-posix</a>. So clone those two repos and for each do <code>mvn install</code>. I <em>think</em> that&apos;s the only dependencies you need to set up. Leiningen will figure out the rest.</p>
<p>To run the tests do <code>lein test</code>. This will start with executing <code>cd /tmp ; lein new chestnut --snapshot</code>, possibly with some options. So to run the tests against your local version, you have to first do a <code>lein install</code>. Also make sure that if the tests are using <code>--snapshot</code>
, that the version you&apos;re installing ends with <code>-SNAPSHOT</code>.</p>
<p>For WebDriver, the tests are currently set up to use Chrome, and to look for the chromedriver executable in <code>~/bin/chromedriver</code>. This might not be suitable for your system. Check the <a href="https://github.com/semperos/clj-webdriver" target="_blank">clj-webdriver</a> docs and make sure it&apos;s able to open a browser. See <code>src/chestnut/test/integration.clj</code> to twiddle with this. You can try this in a REPL to see if a browser pops up:</p>
<pre><code class="lang-clojure"><span class="hljs-list">(<span class="hljs-keyword">System/setProperty</span> <span class="hljs-string">&quot;webdriver.chrome.driver&quot;</span> <span class="hljs-list">(<span class="hljs-keyword"><span class="hljs-built_in">str</span></span> <span class="hljs-list">(<span class="hljs-keyword">System/getenv</span> <span class="hljs-string">&quot;HOME&quot;</span>)</span> <span class="hljs-string">&quot;/bin/chromedriver&quot;</span>)</span>)</span>
<span class="hljs-list">(<span class="hljs-keyword"><span class="hljs-built_in">use</span></span> &apos;clj-webdriver.taxi)</span>
<span class="hljs-list">(<span class="hljs-keyword">set-driver!</span> <span class="hljs-collection">{<span class="hljs-attribute">:browser</span> <span class="hljs-attribute">:chrome</span>}</span> <span class="hljs-string">&quot;https://github.com/plexus/chestnut&quot;</span>)</span>
</code></pre>
<p>Running these test <em>takes time</em>. There&apos;s a lot of JVM booting and shutting down, and it seems as the consecutive tests run this process actually becomes even slower. Because of this you might run into the problem where the test tries to boot a REPL, but this times out. To work around that you can add this to <code>src/leiningen/new/chestnut/project.clj</code>, after which you do a new <code>lein install</code></p>
<pre><code class="lang-clojure">:repl-options {:timeout 200000} ;; Defaults to 30000 (30 seconds)
</code></pre>
<h2 id="basic-test"><a name="basic-test" class="plugin-anchor" href="#basic-test"><span class="fa fa-link"></span></a>Basic Test</h2>
<p>This is implemented now as an automated test, it will be executed for each of the feature flags.</p>
<ul>
<li>generate an app</li>
<li>lein repl</li>
<li>(run)</li>
<li>(browser-repl)</li>
<li>load the page, you should see &quot;Hello, Chestnut&quot;</li>
<li>check the browser connected repl (e.g. <code>@app-state</code>)</li>
<li>change some clojurescript (e.g. <code>s/h1/h2/</code>), watch the browser update</li>
<li>change some CSS, watch it reload</li>
<li>change something in index.html, watch it reload</li>
</ul>
<h2 id="production--heroku-test"><a name="production--heroku-test" class="plugin-anchor" href="#production--heroku-test"><span class="fa fa-link"></span></a>Production / Heroku test</h2>
<p>This needs to be done for each of the feature flags.</p>
<ul>
<li>generate an app</li>
<li>build an uberjar</li>
<li>run with foreman, verify it works</li>
<li>push to heroku, verify it works</li>
</ul>
<h2 id="feature-tests"><a name="feature-tests" class="plugin-anchor" href="#feature-tests"><span class="fa fa-link"></span></a>Feature tests</h2>
<p>These are features, some hidden behind feature flags, that should be verified manually</p>
<ul>
<li>Clojure and Clojurescript unit test support</li>
<li>CLJX</li>
<li>speclj / specljs</li>
<li>LESS</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./03_00_developer_notes.html" class="navigation navigation-prev " aria-label="Previous page: Developer Notes"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./FAQ.html" class="navigation navigation-next " aria-label="Next page: FAQ"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"ga":{"token":"UA-16178122-5","configuration":"auto"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-16178122-5', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
